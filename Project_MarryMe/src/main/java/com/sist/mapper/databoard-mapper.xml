<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.databoard-mapper">

   <!-- 추가 -->
   <insert id="databoardInsert" parameterType="DataBoardVO">
    INSERT INTO project_databoard VALUES(
     (SELECT NVL(MAX(no)+1,1) FROM project_databoard),
     #{name},#{subject},#{content},#{pwd},SYSDATE,0,
     #{filename},#{filesize}
    )
   </insert>
   
   <!-- 목록 -->
   <select id="databoardListData" parameterType="hashmap" resultType="DataBoardVO">
    SELECT no,subject,name,TO_CHAR(regdate,'YYYY-MM-DD') as dbday,hit,num
    FROM (SELECT no,subject,name,regdate,hit,rownum as num 
    FROM (SELECT /*+ INDEX_DESC(project_databoard pd_no_pk)*/no,subject,name,regdate,hit 
    FROM project_databoard))
    WHERE num BETWEEN #{start} AND #{end}
   </select>
   <select id="databoardRowCount" resultType="int">
    SELECT COUNT(*) FROM project_databoard
   </select>
   
   <!-- 상세보기 -->
   <update id="databoardhitIncrement" parameterType="int">
     UPDATE project_databoard SET 
     hit=hit+1
     WHERE no=#{no}
   </update>
   <select id="databoardDetailData" resultType="DataBoardVO" parameterType="int">
     SELECT no,name,subject,content,
            TO_CHAR(regdate,'YYYY-MM-DD HH24:MI:SS') as dbday,
            hit,filename,filesize
     FROM project_databoard
     WHERE no=#{no}
   </select>

    
   <!-- 수정 -->
   <update id="databoardUpdate" parameterType="DataBoardVO">
     UPDATE project_databoard SET
     name=#{name},subject=#{subject},content=#{content},
     filename=#{filename},filesize=#{filesize}
     WHERE no=#{no}
   </update>
   
   <!-- 삭제 -->
   <select id="databoardGetPassword" resultType="string" parameterType="int">
     SELECT pwd FROM project_databoard
     WHERE no=#{no}
   </select>
   <select id="databoardFileInfoData" resultType="DataBoardVO" parameterType="int">
     SELECT filename,filesize 
     FROM project_databoard
     WHERE no=#{no}
   </select>
   <delete id="databoardDelete" parameterType="int">
    DELETE FROM project_databoard
    WHERE no=#{no}
   </delete>
   <delete id="databoardReplyDelete" parameterType="int">
    DELETE FROM project_board_reply
    WHERE bno=#{no}
   </delete>

   <select id="databoardFindData" resultType="DataBoardVO" parameterType="hashmap">
     SELECT no,name,subject,TO_CHAR(regdate,'YYYY-MM-DD') as dbday,hit
     FROM project_databoard
     WHERE
     <trim prefix="(" suffix=")" prefixOverrides="OR">
      <foreach collection="fsArr" item="fs">
       <trim prefix="OR">
         <choose>
          <when test="fs=='N'.toString()">
           name LIKE '%'||#{ss}||'%'
          </when>
          <when test="fs=='S'.toString()">
           subject LIKE '%'||#{ss}||'%'
          </when>
          <when test="fs=='C'.toString()">
           content LIKE '%'||#{ss}||'%'
          </when>
         </choose>
       </trim>
      </foreach>
     </trim>
   </select>
</mapper>